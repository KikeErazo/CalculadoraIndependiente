const SMMLV_2026 = 1750905;

const ingresoInput = document.getElementById("ingreso");
const arlCheck = document.getElementById("arlCheck");
const arlNivelBox = document.getElementById("arlNivelBox");
const ccfCheck = document.getElementById("ccfCheck");
const ccfBox = document.getElementById("ccfBox");
const resultadoDiv = document.getElementById("resultado");

/* Mostrar / ocultar ARL */
arlCheck.addEventListener("change", () => {
    arlNivelBox.classList.toggle("oculto", arlCheck.value === "no");
});

/* Mostrar / ocultar CCF */
ccfCheck.addEventListener("change", () => {
    ccfBox.classList.toggle("oculto", ccfCheck.value === "no");
});

/* Formato pesos en ingreso */
ingresoInput.addEventListener("input", () => {
    let valor = ingresoInput.value.replace(/\D/g, "");
    ingresoInput.value = valor
        ? "$ " + Number(valor).toLocaleString("es-CO")
        : "";
});

function formatoCOP(valor) {
    return Math.round(valor).toLocaleString("es-CO");
}

function calcular() {
    const ingreso = Number(ingresoInput.value.replace(/\D/g, ""));
    if (!ingreso) return;

    let ibcCalculado = ingreso * 0.4;
    let aplicaMinimo = ibcCalculado < SMMLV_2026;
    let ibc = aplicaMinimo ? SMMLV_2026 : ibcCalculado;

    const salud = ibc * 0.125;
    const pension = ibc * 0.16;

    let arl = 0;
    if (arlCheck.value === "si") {
        arl = ibc * (document.getElementById("arlNivel").value / 100);
    }

    let ccf = 0;
    if (ccfCheck.value === "si") {
        const porcentajeCCF = document.getElementById("ccfPorcentaje").value;
        ccf = ibc * (porcentajeCCF / 100);
    }

    const total = salud + pension + arl + ccf;

    resultadoDiv.innerHTML = `
        ${aplicaMinimo ? `
        <div class="alerta">
            El IBC fue ajustado al SMLMV 2026
            ($${formatoCOP(SMMLV_2026)}).
        </div>` : ""}

        <div>IBC: $${formatoCOP(ibc)}</div>
        <div>Salud (12.5%): $${formatoCOP(salud)}</div>
        <div>Pensi√≥n (16%): $${formatoCOP(pension)}</div>
        <div>ARL: $${formatoCOP(arl)}</div>
        <div>CCF: $${formatoCOP(ccf)}</div>
        <div class="total">Total a pagar: $${formatoCOP(total)}</div>
    `;
}

function nuevoCalculo() {
    ingresoInput.value = "";
    resultadoDiv.innerHTML = "";
    arlCheck.value = "no";
    ccfCheck.value = "no";
    arlNivelBox.classList.add("oculto");
    ccfBox.classList.add("oculto");
}
